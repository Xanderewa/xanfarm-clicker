<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>XanFarm Juego</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Reset y base */
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f7f7fa;
      color: #222;
    }
    h2, h3 {
      margin: 0 0 12px 0;
    }
    button {
      background: #46b1e5;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 8px 18px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: background 0.2s;
    }
    button:hover {
      background: #3689b0;
    }
    /* Modales */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.45);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 28px 22px 18px 22px;
      border-radius: 12px;
      min-width: 320px;
      max-width: 95vw;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 4px 22px #0004;
      position: relative;
      transition: background 0.3s;
    }
    .close {
      position: absolute;
      right: 15px; top: 15px;
      font-size: 24px;
      color: #555;
      cursor: pointer;
      font-weight: bold;
    }

    /* FONDOS PERSONALIZADOS PARA CADA COFRE */
    .cofre-fondo-plata {
      background: url('https://i.imgur.com/9DvPrS8.png') center/cover no-repeat, #f7f7f7;
    }
    .cofre-fondo-oro {
      background: url('https://i.imgur.com/MVPWQeH.png') center/cover no-repeat, #fff8e1;
    }
    .cofre-fondo-diamante {
      background: url('https://i.imgur.com/WD9fqx0.png') center/cover no-repeat, #e0f7fa;
    }

    /* FONDO PERSONALIZADO PARA INVENTARIO */
    #inventoryModal .modal-content {
      background: url('https://i.imgur.com/WyHOTjm.png') center/cover no-repeat, #fff;
      color: #222;
    }

    /* Cofre selección */
    .cofre-lista {
      display: flex; justify-content: center; gap: 18px; margin-bottom: 16px;
    }
    .cofre-btn {
      border: none; background: #eee; border-radius: 8px;
      padding: 8px 18px; font-weight: bold; font-size: 16px;
      cursor: pointer; box-shadow: 0 2px 8px #0002;
      transition: background 0.2s;
    }
    .cofre-btn.selected, .cofre-btn:hover { background: #d2f0f3; }

    /* Inventario */
    #inventarioLista {
      display: flex; flex-wrap: wrap; gap: 18px;
      justify-content: center;
    }
    .plant {
      background: #fff8;
      border-radius: 12px;
      box-shadow: 0 2px 8px #0001;
      padding: 10px 12px;
      min-width: 135px;
      display: flex; align-items: center; gap: 12px;
      transition: background 0.2s;
    }
    .plant img {
      width: 48px; height: 48px;
      border-radius: 8px;
      background: #eee;
      object-fit: contain;
      border: 1px solid #ddd;
    }
    .plant-info {
      flex: 1;
      font-size: 15px;
    }
    .production { font-size: 13px; color: #6c47a4; }

    /* Tienda */
    .paquete-tienda {
      background: #fbeedc;
      border-radius: 9px;
      box-shadow: 0 2px 10px #0001;
      padding: 12px 15px;
      margin-bottom: 16px;
      display: flex; flex-direction: column; align-items: center;
    }
    .paquete-img {
      width: 70px; height: 70px; margin-bottom: 12px;
    }

    /* Canje */
    .canjear-codigo-box {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .canjear-codigo-box input {
      padding: 6px 10px;
      border-radius: 5px;
      border: 1px solid #bbb;
      font-size: 16px;
    }
    .canjear-codigo-box button {
      background: #46b1e5;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 6px 16px;
      cursor: pointer;
      font-weight: bold;
    }
    .canjear-codigo-box button:hover {
      background: #3689b0;
    }
  </style>
</head>
<body>
  <header>
    <h2 style="text-align:center; margin:20px 0;">XanFarm Juego</h2>
    <div style="text-align:center;">
      <button onclick="abrirInventario()">Inventario</button>
      <button onclick="abrirTienda()">Tienda</button>
      <button onclick="abrirCofres()">Cofres</button>
    </div>
  </header>

  <!-- MODAL INVENTARIO -->
  <div id="inventoryModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarInventario()">&times;</span>
      <h3>Inventario de Cultivos</h3>
      <div id="inventarioLista"></div>
    </div>
  </div>

  <!-- MODAL TIENDA -->
  <div id="tiendaModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarTienda()">&times;</span>
      <h3>Tienda de Llaves</h3>
      <div id="paquetesTienda"></div>
      <!-- Campo para canjear código -->
      <div class="canjear-codigo-box">
        <input id="codigoInput" type="text" placeholder="Ingresa tu código de paquete">
        <button onclick="canjearCodigo()">Canjear</button>
      </div>
    </div>
  </div>

  <!-- MODAL COFRES -->
  <div id="cofreModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarCofres()">&times;</span>
      <h3>Cofres</h3>
      <div class="cofre-lista">
        <button class="cofre-btn" id="btn-plata" onclick="mostrarCofre('plata')">Plata</button>
        <button class="cofre-btn" id="btn-oro" onclick="mostrarCofre('oro')">Oro</button>
        <button class="cofre-btn" id="btn-diamante" onclick="mostrarCofre('diamante')">Diamante</button>
      </div>
      <div id="contenidoCofre"></div>
    </div>
  </div>
</body>
<script>
// ================== VARIABLES INICIALES ==================
let user = {
  keys: 0,
  inventory: [
    { nombre: "Trigo", cantidad: 8, produccion: "+1 llaves/h", img: "https://i.imgur.com/ww8h9vT.png" },
    { nombre: "Maíz", cantidad: 5, produccion: "+2 llaves/h", img: "https://i.imgur.com/9JjfVRg.png" }
    // ... agrega tus cultivos reales
  ]
};

// ================== INVENTARIO ==================
function abrirInventario() {
  document.getElementById("inventoryModal").style.display = "flex";
  renderizarInventario();
}
function cerrarInventario() {
  document.getElementById("inventoryModal").style.display = "none";
}
function renderizarInventario() {
  const cont = document.getElementById("inventarioLista");
  cont.innerHTML = "";
  user.inventory.forEach(cultivo => {
    cont.innerHTML += `
      <div class="plant">
        <img src="${cultivo.img}">
        <div class="plant-info">
          <b>${cultivo.nombre}</b><br>
          Cantidad: ${cultivo.cantidad}<br>
          <span class="production">${cultivo.produccion}</span>
        </div>
      </div>
    `;
  });
}

// ================== TIENDA ==================
const paquetes = [
  { nombre: "10 Llaves", precio: "1 USD", img: "https://i.imgur.com/3w3iJcL.png" },
  { nombre: "25 Llaves", precio: "2 USD", img: "https://i.imgur.com/oRmw2qP.png" },
  { nombre: "60 Llaves", precio: "4 USD", img: "https://i.imgur.com/pAHiQyt.png" }
];
function abrirTienda() {
  document.getElementById("tiendaModal").style.display = "flex";
  renderizarTienda();
}
function cerrarTienda() {
  document.getElementById("tiendaModal").style.display = "none";
}
function renderizarTienda() {
  const cont = document.getElementById("paquetesTienda");
  cont.innerHTML = "";
  paquetes.forEach((paq, i) => {
    cont.innerHTML += `
      <div class="paquete-tienda">
        <img src="${paq.img}" class="paquete-img">
        <b>${paq.nombre}</b>
        <div>${paq.precio}</div>
        <button onclick="comprarPaqueteTienda(${i})">Comprar</button>
      </div>
    `;
  });
}
// Botón de compra: abre Telegram con parámetro de paquete
window.comprarPaqueteTienda = function(i) {
  const botUsername = "XanFarmPaybot";
  window.open(`https://t.me/${botUsername}?start=paquete${i+1}`, "_blank");
};

// ================== CANJE DE CÓDIGOS ==================
const codigosValidos = {
  "XAN-1234-PAQ1": { paquete: 1, descripcion: "Paquete 1: 10 llaves" },
  "XAN-5678-PAQ2": { paquete: 2, descripcion: "Paquete 2: 25 llaves" },
  "XAN-9999-PAQ3": { paquete: 3, descripcion: "Paquete 3: 60 llaves" }
  // ... agrega tus códigos reales
};
function canjearCodigo() {
  const input = document.getElementById("codigoInput").value.trim();
  if (!input) { alert("Ingresa un código."); return; }
  const usados = JSON.parse(localStorage.getItem("codigosUsados") || "[]");
  if (usados.includes(input)) {
    alert("Ya usaste este código.");
    return;
  }
  if (codigosValidos[input]) {
    const paquete = codigosValidos[input].paquete;
    alert("¡Código válido! Has recibido: " + codigosValidos[input].descripcion);
    // Entregar el paquete correspondiente
    if (paquete === 1) user.keys += 10;
    else if (paquete === 2) user.keys += 25;
    else if (paquete === 3) user.keys += 60;
    // Marcar el código como usado
    usados.push(input);
    localStorage.setItem("codigosUsados", JSON.stringify(usados));
    actualizarLlavesUI();
  } else {
    alert("Código inválido.");
  }
}

// Mostrar cantidad de llaves (puedes ponerlo en tu UI donde quieras)
function actualizarLlavesUI() {
  // Aquí debes actualizar donde muestres las llaves, por ejemplo:
  // document.getElementById("llavesUI").innerText = user.keys + " llaves";
  // Puedes agregarlo en tu header si quieres
}

// ================== COFRES ==================
let cofreActual = "plata";
function abrirCofres() {
  document.getElementById("cofreModal").style.display = "flex";
  mostrarCofre("plata");
}
function cerrarCofres() {
  document.getElementById("cofreModal").style.display = "none";
}
function mostrarCofre(tipo) {
  cofreActual = tipo;
  actualizarCofreUI(tipo);
  // Actualiza botón activo
  document.getElementById("btn-plata").classList.remove("selected");
  document.getElementById("btn-oro").classList.remove("selected");
  document.getElementById("btn-diamante").classList.remove("selected");
  document.getElementById("btn-" + tipo).classList.add("selected");
}
function actualizarCofreUI(tipo) {
  // FONDO según cofre
  const modalContent = document.querySelector("#cofreModal .modal-content");
  modalContent.classList.remove('cofre-fondo-plata', 'cofre-fondo-oro', 'cofre-fondo-diamante');
  if(tipo === 'plata') modalContent.classList.add('cofre-fondo-plata');
  else if(tipo === 'oro') modalContent.classList.add('cofre-fondo-oro');
  else if(tipo === 'diamante') modalContent.classList.add('cofre-fondo-diamante');

  // Contenido del cofre
  let contenido = "";
  if (tipo === "plata") {
    contenido = `
      <img src="https://i.imgur.com/9DvPrS8.png" style="width:90px; display:block; margin:auto;">
      <div style="text-align:center; margin:10px 0 18px 0;">Cofre de Plata</div>
      <button onclick="abrirCofrePremio('plata')">Abrir Cofre (5 llaves)</button>
    `;
  } else if (tipo === "oro") {
    contenido = `
      <img src="https://i.imgur.com/MVPWQeH.png" style="width:90px; display:block; margin:auto;">
      <div style="text-align:center; margin:10px 0 18px 0;">Cofre de Oro</div>
      <button onclick="abrirCofrePremio('oro')">Abrir Cofre (12 llaves)</button>
    `;
  } else if (tipo === "diamante") {
    contenido = `
      <img src="https://i.imgur.com/WD9fqx0.png" style="width:90px; display:block; margin:auto;">
      <div style="text-align:center; margin:10px 0 18px 0;">Cofre Diamante</div>
      <button onclick="abrirCofrePremio('diamante')">Abrir Cofre (28 llaves)</button>
    `;
  }
  document.getElementById("contenidoCofre").innerHTML = contenido;
}

// Simulación de abrir cofre
function abrirCofrePremio(tipo) {
  let costo = 0, premio = "";
  if (tipo === "plata") { costo = 5; premio = "¡Ganaste 2 Trigos!"; }
  else if (tipo === "oro") { costo = 12; premio = "¡Ganaste 1 Maíz y 1 Trigo!"; }
  else if (tipo === "diamante") { costo = 28; premio = "¡Ganaste 2 Maíz y 2 Trigo!"; }
  if (user.keys < costo) {
    alert("No tienes suficientes llaves.");
    return;
  }
  user.keys -= costo;
  actualizarLlavesUI();
  alert(premio);
  // Aquí puedes añadir lógica para agregar el premio real al inventario
}

// ================== CIERRE MODALES AL TOCAR FUERA ==================
window.onclick = function(event) {
  ['inventoryModal', 'tiendaModal', 'cofreModal'].forEach(id => {
    const modal = document.getElementById(id);
    if (event.target === modal) modal.style.display = "none";
  });
};

// ================== INICIALIZACIÓN ==================
actualizarLlavesUI();

</script>
