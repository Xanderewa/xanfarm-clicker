<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>XanFarm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    /* --- ESTILOS BASE --- */
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #fefae0;
      height: 100%;
      width: 100vw;
      overscroll-behavior: contain;
    }
    
    /* --- PANTALLA PRINCIPAL --- */
    #pantallaPrincipal {
      background-image: url("https://i.imgur.com/qbJMnhv.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
      min-width: 100vw;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      color: white;
      padding: 20px 0 0 0;
      z-index: 1;
      position: relative;
      box-sizing: border-box;
    }
    
    /* --- BARRA DE MONEDAS --- */
    .moneda-bar {
      margin: 0 0 10px 0;
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
    }
    .moneda-bar span {
      background: rgba(255,255,255,0.85);
      color: #333;
      border-radius: 16px;
      padding: 6px 14px;
      margin: 0 2px;
      font-weight: bold;
      display: inline-block;
      min-width: 70px;
    }
    
    /* --- MEN√ö INFERIOR --- */
    .menu {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;
      background: #fff;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      padding: 10px 0;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      z-index: 999;
    }
    .menu button {
      flex: 1 0 30%;
      margin: 6px 4px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #fff;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .menu button:active { transform: scale(0.97); }
    
    /* --- MODALES --- */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      width: 92%;
      max-width: 450px;
      text-align: center;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    /* --- FONDOS PERSONALIZADOS --- */
    #profileModal .modal-content {
      background: url('https://i.imgur.com/W3U6oaj.png') center/cover;
      color: white;
      border: 3px solid #4dd599;
    }
    #inventoryModal .modal-content {
      background: url('https://i.imgur.com/WyHOTjm.png') center/cover;
    }
    #cofreModal .modal-content {
      background: url('https://i.imgur.com/cvlHO5s.png') center/cover;
    }
    .cofre-oro .modal-content {
      background: url('https://i.imgur.com/CW79Dj0.png') center/cover;
    }
    .cofre-diamante .modal-content {
      background: url('https://i.imgur.com/WD9fqx0.png') center/cover;
    }
    
    /* --- RANGOS GAMER --- */
    .rango-leyenda { 
      color: #ffdf00; 
      text-shadow: 0 0 10px #ff8000;
      animation: brillo-leyenda 2s infinite;
    }
    .rango-epico { color: #c000ff; text-shadow: 0 0 8px #ff00d4; }
    .rango-raro { color: #00b4ff; text-shadow: 0 0 5px #0066ff; }
    @keyframes brillo-leyenda {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(360deg); }
    }
    
    /* --- COFRES --- */
    .cofre-img {
      width: 140px;
      max-width: 80vw;
      margin: 24px auto 12px auto;
      display: block;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .cofre-img.abierto {
      animation: cofre-abierto 0.7s cubic-bezier(.21,1.02,.73,.97);
    }
    @keyframes cofre-abierto {
      0% { transform: scale(1) rotate(0deg);}
      30% { transform: scale(1.18) rotate(-8deg);}
      60% { transform: scale(1.1) rotate(6deg);}
      100% { transform: scale(1) rotate(0deg);}
    }
    .cofre-info {
      margin-bottom: 14px;
      color: #222;
      font-weight: bold;
      background: rgba(255,255,255,0.8);
      padding: 10px;
      border-radius: 8px;
    }
    
    /* --- INVENTARIO --- */
    .plant {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      background: rgba(255,255,255,0.9);
      text-align: left;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .plant img {
      width: 50px;
      border-radius: 5px;
      image-rendering: pixelated;
    }
    .production {
      color: #3777ca;
      font-size: 14px;
      font-weight: bold;
      margin-left: 8px;
    }
    
    /* --- PRODUCCI√ìN --- */
    #progresoProduccion {
      width: 270px;
      height: 22px;
      background: #eee;
      border-radius: 13px;
      margin: 10px auto 5px auto;
      position: relative;
      overflow: hidden;
      border: 1.5px solid #bdbdbd;
      box-shadow: 0 1px 5px #0001;
    }
    #barraProduccion {
      position: absolute;
      left: 0; top: 0; bottom: 0;
      height: 100%;
      background: linear-gradient(90deg, #ffe066, #4dd599 90%);
      width: 0%;
      border-radius: 13px 0 0 13px;
      transition: width 0.7s cubic-bezier(.23,.89,.43,.99);
    }
    
    /* --- BOTONES --- */
    .btn-comprar {
      background: #4dd599;
      color: #13314e;
      border: none;
      padding: 8px 20px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-comprar:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px #4dd599;
    }
    .btn-peligro {
      background: #ff4d4d;
      color: white;
      margin: 10px 0;
    }
    
    /* --- CULTIVO SECRETO --- */
    .cultivo-secreto {
      background: linear-gradient(45deg, #6a00ff, #ff00f7);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      margin: 10px;
      cursor: pointer;
      animation: brillo-secreto 3s infinite;
      font-weight: bold;
    }
    @keyframes brillo-secreto {
      0% { filter: brightness(1); box-shadow: 0 0 5px #6a00ff; }
      50% { filter: brightness(1.2); box-shadow: 0 0 20px #ff00f7; }
      100% { filter: brightness(1); box-shadow: 0 0 5px #6a00ff; }
    }
    
    /* --- TIENDA --- */
    .paquete {
      background: rgba(0,0,0,0.7);
      border: 2px solid #4dd599;
      border-radius: 12px;
      padding: 15px;
      margin: 10px 0;
      color: white;
    }
    .paquete h3 {
      margin-top: 0;
      color: #ffe066;
    }
    
    /* --- OPCIONES --- */
    .brillo-slider {
      width: 100%;
      margin: 10px 0;
    }
    
    /* --- ANIMACIONES --- */
    @keyframes monedasSalto {
      0% { opacity:0; transform: translate(-50%,30px) scale(0.7);}
      20% { opacity:1; transform: translate(-50%,-16px) scale(1.07);}
      60% { opacity:1; transform: translate(-50%,-28px) scale(1.07);}
      100% { opacity:0; transform: translate(-50%,0) scale(0.7);}
    }
  </style>
</head>
<body>
  <!-- ESTRUCTURA PRINCIPAL -->
  <div id="recoleccionAnimada"></div>
  <div id="pantallaPrincipal">
    <h1>üå± ¬°Bienvenido a XanFarm!</h1>
    <div class="moneda-bar">
      <span>
        <img src="https://i.imgur.com/n9OyA2U.png" class="moneda-icon" alt="Moneda">
        Monedas: <span id="coins">0</span>
      </span>
      <span>üîë Llaves: <span id="keys">0</span></span>
    </div>
    <div id="progresoProduccion">
      <div id="barraProduccion"></div>
    </div>
    <div id="contadorProduccion"><b>Producci√≥n lista en:</b> <span id="timerProduccion">--:--:--</span></div>
    <button id="btnRecolectar" disabled>
      <img id="granjeroAnim" src="https://i.imgur.com/bCqQ3gO.gif" alt="Granjero corriendo" style="background:#eee;">
      Recolectar producci√≥n
    </button>
    <!-- BOT√ìN SECRETO A√ëADIDO -->
    <button id="btnSecreto" class="cultivo-secreto">üåå Cultivo Secreto</button>
  </div>

  <!-- MEN√ö -->
  <div class="menu">
    <button id="botonPerfil">üßë‚Äçüíª Perfil</button>
    <button id="botonInventario">üéí Inventario</button>
    <button id="botonCofre">üéÅ Cofre</button>
    <button id="botonMisiones">üß≠ Misiones</button>
    <button id="botonTienda">üè™ Tienda</button>
    <button id="botonOpciones">‚öôÔ∏è Opciones</button>
  </div>

  <!-- MODALES -->
  <!-- Perfil -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarPerfilBtn">√ó</span>
      <h2>üßë‚Äçüåæ Tu Perfil</h2>
      <p><strong>Rango:</strong> <span id="perfilRango" class="rango-leyenda">Minero Principiante</span></p>
      <p><strong>Producci√≥n diaria:</strong> <span id="perfilProduccion">0</span> monedas/d√≠a</p>
      <p><strong>Monedas:</strong> <span id="perfilCoins">0</span></p>
      <p><strong>Llaves:</strong> <span id="perfilKeys">0</span></p>
    </div>
  </div>

  <!-- Inventario -->
  <div id="inventoryModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarInventarioBtn">√ó</span>
      <h2>üéí Inventario de Cultivos</h2>
      <div id="plantList"></div>
    </div>
  </div>

  <!-- Cofres -->
  <div id="cofreModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarCofreBtn">√ó</span>
      <h2 id="tituloCofre">üéÅ Cofre Plata</h2>
      <div class="tab-selector">
        <button id="tabPlata" class="active">Plata</button>
        <button id="tabOro">Oro</button>
        <button id="tabDiamante">Diamante</button>
      </div>
      <img id="imgCofre" class="cofre-img" src="https://i.imgur.com/dYd1aoN.png" alt="Cofre" />
      <div class="cofre-info" id="cofreInfo">
        Necesitas <span id="llavesNecesarias">10</span> llaves para abrir este cofre.<br>
        <span class="cofre-keys">Tienes: <span id="userKeys">0</span> llaves</span>
      </div>
      <button id="abrirCofreBtn" class="cofre-open-btn">Abrir Cofre de Plata</button>
      <div id="resultadoCofre"></div>
      <button id="cerrarCofreBtn2">Cerrar</button>
    </div>
  </div>

  <!-- Tienda -->
  <div id="shopModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarTiendaBtn">√ó</span>
      <h2>üè™ Tienda</h2>
      <div class="tab-selector">
        <button class="active" data-tab="paquetes">üîë Paquetes</button>
        <button data-tab="conversion">üíé Convertir</button>
      </div>
      <div id="tiendaContenido">
        <!-- Contenido din√°mico -->
      </div>
    </div>
  </div>

  <!-- Opciones -->
  <div id="optionsModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarOpcionesBtn">√ó</span>
      <h2>‚öôÔ∏è Opciones</h2>
      
      <div class="opcion">
        <h3>Ajustar Brillo</h3>
        <input type="range" min="50" max="150" value="100" class="brillo-slider" id="sliderBrillo">
      </div>
      
      <button onclick="borrarProgreso()" class="btn-comprar btn-peligro">üóëÔ∏è Borrar Progreso</button>
      
      <div class="politicas-privacidad">
        <h3>üîí Pol√≠ticas de Privacidad</h3>
        <p>Tus datos se guardan localmente en tu dispositivo. No recolectamos informaci√≥n personal.</p>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // ========== CONSTANTES Y VARIABLES ==========
    const PLANTS_DEFAULT = [
      { nombre: "Pi√±a dorada", valor: 500, cantidad: 0, rareza: "Legendaria", img: "https://i.imgur.com/y0et0jw.png" },
      { nombre: "Uva el√©ctrica", valor: 350, cantidad: 0, rareza: "Legendaria", img: "https://i.imgur.com/igHZ4i0.png" },
      { nombre: "Cereza de lava", valor: 350, cantidad: 0, rareza: "Legendaria", img: "https://i.imgur.com/FZ3ix2y.png" },
      { nombre: "Flor de cacao", valor: 180, cantidad: 0, rareza: "√âpica", img: "https://i.imgur.com/teOuyYL.png" },
      { nombre: "Mel√≥n √°mbar", valor: 180, cantidad: 0, rareza: "√âpica", img: "https://i.imgur.com/fnASHdb.png" },
      { nombre: "Frijol lunar", valor: 70, cantidad: 0, rareza: "Rara", img: "https://i.imgur.com/uENLIRn.png" },
      { nombre: "Zanahoria cristal", valor: 70, cantidad: 0, rareza: "Rara", img: "https://i.imgur.com/axk0pOC.png" },
      { nombre: "Choclo m√≠stico", valor: 70, cantidad: 0, rareza: "Rara", img: "https://i.imgur.com/ram9D6B.png" },
      { nombre: "Ma√≠z dulce", valor: 30, cantidad: 0, rareza: "Com√∫n", img: "https://i.imgur.com/E2qm0LM.png" },
      { nombre: "Tomate solar", valor: 30, cantidad: 0, rareza: "Com√∫n", img: "https://i.imgur.com/imJ5yn3.png" },
      { nombre: "Trigo solar", valor: 30, cantidad: 0, rareza: "Com√∫n", img: "https://i.imgur.com/X8D6y8K.png" }
    ];

    const PAQUETES_TIENDA = [
      { 
        id: 1, 
        nombre: "Paquete Inicial", 
        llaves: 100, 
        cultivos: [{ rareza: "√âpica", cantidad: 1 }], 
        precio: 2.99,
        descripcion: "Perfecto para empezar"
      },
      { 
        id: 2, 
        nombre: "Paquete Avanzado", 
        llaves: 250, 
        cultivos: [{ rareza: "Rara", cantidad: 3 }], 
        precio: 5,
        descripcion: "Impulsa tu granja"
      },
      { 
        id: 3, 
        nombre: "Paquete √âpico", 
        llaves: 500, 
        cultivos: [
          { rareza: "√âpica", cantidad: 2 },
          { rareza: "Rara", cantidad: 2 }
        ], 
        precio: 10,
        descripcion: "Crecimiento garantizado"
      },
      { 
        id: 4, 
        nombre: "Paquete Legendario", 
        llaves: 700, 
        cultivos: [{ rareza: "Legendaria", cantidad: 1 }], 
        precio: 20,
        descripcion: "¬°Un legendario te espera!"
      },
      { 
        id: 5, 
        nombre: "Paquete Mega √âpico", 
        llaves: 1000, 
        cultivos: [
          { rareza: "Legendaria", cantidad: 1 },
          { rareza: "√âpica", cantidad: 2 }
        ], 
        precio: 35,
        descripcion: "El poder en tus manos"
      },
      { 
        id: 6, 
        nombre: "Paquete Semanal VIP", 
        llaves: 2100, // 300/d√≠a
        cultivos: [
          { rareza: "Legendaria", cantidad: 3 },
          { rareza: "√âpica", cantidad: 5 }
        ], 
        precio: 15,
        descripcion: "300 llaves/d√≠a por 7 d√≠as"
      }
    ];

    // Variables del juego
    let coins = 0, keys = 0;
    let plants = JSON.parse(JSON.stringify(PLANTS_DEFAULT));
    let cofresGratis = { oro: 0, plata: 0 };
    let lastRecolectado = Date.now();
    const periodoRecolecta = 12 * 60 * 60 * 1000; // 12 horas

    // ========== FUNCIONES B√ÅSICAS ==========
    function guardarProgreso() {
      localStorage.setItem("xanfarm-progreso", JSON.stringify({
        coins, keys, plants, cofresGratis, lastRecolectado
      }));
    }
    
    function cargarProgreso() {
      const data = localStorage.getItem("xanfarm-progreso");
      if (!data) return false;
      try {
        const obj = JSON.parse(data);
        coins = obj.coins ?? 0;
        keys = obj.keys ?? 0;
        plants = obj.plants ?? JSON.parse(JSON.stringify(PLANTS_DEFAULT));
        cofresGratis = obj.cofresGratis ?? { oro: 0, plata: 0 };
        lastRecolectado = obj.lastRecolectado ?? Date.now();
        return true;
      } catch { return false; }
    }

    // ========== SISTEMA DE PRODUCCI√ìN ==========
    function produccionPorMinuto() {
      let total = 0;
      plants.forEach(p => total += (p.valor * p.cantidad) / 1440);
      return total;
    }

    function produccionPorDia() {
      let total = 0;
      plants.forEach(p => total += p.valor * p.cantidad);
      return total;
    }

    function actualizarBarraProduccion() {
      const ahora = Date.now();
      const tiempoPasado = Math.max(0, ahora - lastRecolectado);
      const progreso = Math.min(1, tiempoPasado / periodoRecolecta);
      document.getElementById("barraProduccion").style.width = (progreso * 100) + "%";
      
      let tiempoRestante = periodoRecolecta - tiempoPasado;
      if (tiempoRestante < 0) tiempoRestante = 0;
      document.getElementById("timerProduccion").innerText = msToHMS(tiempoRestante);
      
      document.getElementById("btnRecolectar").disabled = progreso < 1 || produccionPorMinuto() === 0;
    }

    function msToHMS(ms) {
      let total = Math.floor(ms / 1000);
      const h = String(Math.floor(total / 3600)).padStart(2, "0");
      total %= 3600;
      const m = String(Math.floor(total / 60)).padStart(2, "0");
      const s = String(total % 60).padStart(2, "0");
      return `${h}:${m}:${s}`;
    }

    // ========== SISTEMA DE COFRES ==========
    const cofres = {
      plata: { 
        nombre: "Plata", 
        img: "https://i.imgur.com/dYd1aoN.png", 
        llaves: 10, 
        btnTexto: "Abrir Cofre de Plata" 
      },
      oro: { 
        nombre: "Oro", 
        img: "https://i.imgur.com/HpkO9qJ.png", 
        llaves: 50, 
        btnTexto: "Abrir Cofre de Oro" 
      },
      diamante: { 
        nombre: "Diamante", 
        img: "https://i.imgur.com/HanPFOR.png", 
        llaves: 100, 
        btnTexto: "Abrir Cofre Diamante" 
      }
    };

    const probabilidades = {
      plata: [ 
        { rareza: "Legendaria", prob: 2.5 },
        { rareza: "√âpica", prob: 10 },
        { rareza: "Rara", prob: 37.5 },
        { rareza: "Com√∫n", prob: 50 }
      ],
      oro: [ 
        { rareza: "Legendaria", prob: 10 },
        { rareza: "√âpica", prob: 25 },
        { rareza: "Rara", prob: 35 },
        { rareza: "Com√∫n", prob: 30 }
      ],
      diamante: [ 
        { rareza: "Legendaria", prob: 20 },
        { rareza: "√âpica", prob: 35 },
        { rareza: "Rara", prob: 30 },
        { rareza: "Com√∫n", prob: 15 }
      ]
    };

    function actualizarCofreUI(tipo) {
      const cofre = cofres[tipo];
      document.getElementById("tituloCofre").innerText = `üéÅ Cofre ${cofre.nombre}`;
      document.getElementById("imgCofre").src = cofre.img;
      document.getElementById("llavesNecesarias").innerText = cofre.llaves;
      
      let gratis = cofresGratisDisponibles(tipo);
      let infoExtra = gratis > 0 ? 
        `<div style="color:#24c24c;font-weight:bold;">Te quedan ${gratis} cofres gratis para abrir</div>` : 
        "";
      
      document.getElementById("cofreInfo").innerHTML = `
        Necesitas <span id="llavesNecesarias">${cofre.llaves}</span> llaves para abrir este cofre.<br>
        <span class="cofre-keys">Tienes: <span id="userKeys">${keys}</span> llaves</span>
        ${infoExtra}
      `;
      
      document.getElementById("abrirCofreBtn").innerText = cofre.btnTexto;
      document.getElementById("abrirCofreBtn").disabled = (keys < cofre.llaves && gratis === 0);
      document.getElementById("resultadoCofre").innerHTML = "";
    }

    function abrirCofre(tipo, esGratis) {
      const imgCofre = document.getElementById("imgCofre");
      imgCofre.classList.add("abierto");
      
      setTimeout(() => {
        imgCofre.classList.remove("abierto");
        const resultado = calcularCofre(tipo);
        mostrarResultadoCofre(resultado);
        guardarProgreso();
      }, 700);
    }

    function calcularCofre(tipo) {
      const tabla = probabilidades[tipo];
      const random = Math.random() * 100;
      let acumulado = 0;
      let rarezaElegida = "Com√∫n";
      
      for (const p of tabla) {
        acumulado += p.prob;
        if (random <= acumulado) {
          rarezaElegida = p.rareza;
          break;
        }
      }
      
      let posibles = plants.filter(p => p.rareza === rarezaElegida);
      return posibles[Math.floor(Math.random() * posibles.length)];
    }

    // ========== INTERFAZ DE USUARIO ==========
    function mostrarInventario() {
      const lista = document.getElementById("plantList");
      lista.innerHTML = "";
      let totalProd = 0;
      
      plants.forEach((planta) => {
        if (planta.cantidad > 0) {
          totalProd += planta.valor * planta.cantidad;
          lista.innerHTML += `
          <div class="plant">
            <img src="${planta.img}" alt="${planta.nombre}">
            <div class="plant-info">
              <b>${planta.nombre}</b> 
              <span style="color:${
                planta.rareza === "Legendaria" ? "#ffdf00" :
                planta.rareza === "√âpica" ? "#c000ff" : "#00b4ff"
              };">[${planta.rareza}]</span><br>
              Cantidad: <b>${planta.cantidad}</b>
              <span class="production">+${planta.valor * planta.cantidad} monedas/d√≠a</span>
            </div>
          </div>
          `;
        }
      });
      
      if (totalProd === 0) {
        lista.innerHTML = `<div style="color:#888;font-size:1.1em;margin:20px 0;">A√∫n no tienes cultivos.<br>¬°Abre cofres para empezar!</div>`;
      }
    }

    function mostrarTienda(tab = "paquetes") {
      let html = "";
      
      if (tab === "paquetes") {
        html = PAQUETES_TIENDA.map(p => `
          <div class="paquete">
            <h3>${p.nombre}</h3>
            <p>${p.descripcion}</p>
            <p><b>${p.llaves} llaves</b> + ${p.cultivos.map(c => `${c.cantidad}x ${c.rareza}`).join(", ")}</p>
            <button class="btn-comprar" onclick="comprarPaquete(${p.id})">$${p.precio} USD</button>
          </div>
        `).join("");
      } else {
        html = `
          <div class="paquete">
            <h3>üíé Convertir Monedas</h3>
            <p>100 monedas = 10 llaves</p>
            <button class="btn-comprar" onclick="convertirMonedas()">Convertir</button>
          </div>
        `;
      }
      
      document.getElementById("tiendaContenido").innerHTML = html;
    }

    // ========== FUNCIONALIDADES NUEVAS ==========
    function comprarPaquete(id) {
      alert("¬°Redirigiendo a m√©todo de pago!\n\n(En la versi√≥n final esto conectar√° con Telegram/TON)");
      // Aqu√≠ ir√≠a la l√≥gica de compra real
    }

    function convertirMonedas() {
      if (coins >= 100) {
        coins -= 100;
        keys += 10;
        actualizarMonedas();
        actualizarLlaves();
        alert("¬°Conversi√≥n exitosa! +10 llaves");
      } else {
        alert("Necesitas al menos 100 monedas");
      }
    }

    function borrarProgreso() {
      if (confirm("‚ö†Ô∏è ¬øBorrar TODOS tus datos? Esto no se puede deshacer.")) {
        localStorage.clear();
        location.reload();
      }
    }

    // ========== EVENT LISTENERS ==========
    document.getElementById("botonOpciones").addEventListener("click", () => {
      document.getElementById("optionsModal").style.display = "flex";
    });

    document.getElementById("sliderBrillo").addEventListener("input", (e) => {
      document.documentElement.style.filter = `brightness(${e.target.value}%)`;
    });

    document.getElementById("btnSecreto").addEventListener("click", () => {
      alert("¬°Pr√≥ximamente! üåü\n\n(Secretos √©picos en desarrollo...)");
    });

    // ========== INICIALIZACI√ìN ==========
    function init() {
      // Cargar progreso o iniciar nuevo juego
      if (!cargarProgreso()) {
        coins = 0;
        keys = 0;
        plants.forEach(p => p.cantidad = 0);
        cofresGratis = { oro: 1, plata: 3 };
        lastRecolectado = Date.now();
        guardarProgreso();
      }

      // Actualizar UI
      actualizarMonedas();
      actualizarLlaves();
      mostrarInventario();
      setInterval(actualizarBarraProduccion, 1000);
    }

    init();
  });
  </script>
</body>
</html>