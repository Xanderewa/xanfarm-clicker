<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>XanFarm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #fefae0;
      overscroll-behavior: contain;
    }
    #pantallaPrincipal {
      background-image: url("https://i.imgur.com/qbJMnhv.png");
      background-size: cover;
      background-position: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      color: white;
      padding: 20px 0 0 0;
      position: relative;
    }
    .moneda-bar {
      margin: 0 0 10px 0;
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
    }
    .moneda-bar span {
      background: rgba(255,255,255,0.85);
      color: #333;
      border-radius: 16px;
      padding: 6px 14px;
      font-weight: bold;
      min-width: 70px;
    }
    .menu {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;
      background: #fff;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      padding: 10px 0;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      z-index: 999;
    }
    .menu button {
      flex: 1 0 30%;
      margin: 6px 4px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #fff;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .menu button:active { transform: scale(0.97); }

    /* --- Modales --- */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      width: 92%;
      max-width: 450px;
      text-align: center;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      color: #222;
    }
    .close-btn {
      align-self: flex-end;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
    }

    /* --- Fondos Especiales --- */
    #profileModal .modal-content {
      background: url("https://i.imgur.com/W3U6oaj.png") center/cover no-repeat, linear-gradient(135deg, #1a1a2e, #16213e);
      color: white;
      border: 2px solid #4dd599;
    }
    #inventoryModal .modal-content {
      background: url("https://i.imgur.com/WyHOTjm.png") center/cover no-repeat, #f9f9f9;
    }

    /* --- Rangos Gamer --- */
    #perfilRango {
      font-weight: bold;
      padding: 4px 12px;
      border-radius: 20px;
      display: inline-block;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div id="pantallaPrincipal">
    <h1>üå± ¬°Bienvenido a XanFarm!</h1>
    <div class="moneda-bar">
      <span>
        <img src="https://i.imgur.com/n9OyA2U.png" class="moneda-icon" alt="Moneda">
        Monedas: <span id="coins">0</span>
      </span>
      <span>üîë Llaves: <span id="keys">0</span></span>
    </div>
    <!-- Barra de producci√≥n -->
    <div id="progresoProduccion">
      <div id="barraProduccion"></div>
    </div>
    <div id="contadorProduccion"><b>Producci√≥n lista en:</b> <span id="timerProduccion">--:--:--</span></div>
    <button id="btnRecolectar" disabled>
      <img id="granjeroAnim" src="https://i.imgur.com/bCqQ3gO.gif" alt="Granjero">
      Recolectar producci√≥n
    </button>
  </div>

  <!-- Men√∫ inferior -->
  <div class="menu">
    <button id="botonPerfil">üßë‚Äçüíª Perfil</button>
    <button id="botonInventario">üéí Inventario</button>
    <button id="botonCofre">üéÅ Cofre</button>
    <button id="botonMisiones">üß≠ Misiones</button>
    <button id="botonTienda">üè™ Tienda</button>
    <button id="botonOpciones">‚öôÔ∏è Opciones</button>
  </div>

  <!-- Modal de Perfil -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarPerfilBtn">√ó</span>
      <h2>üßë‚Äçüåæ Tu Perfil</h2>
      <p><strong>Rango:</strong> <span id="perfilRango" data-rango="Minero Principiante">Minero Principiante</span></p>
      <p><strong>Producci√≥n diaria:</strong> <span id="perfilProduccion">0</span> monedas/d√≠a</p>
      <p><strong>Monedas:</strong> <span id="perfilCoins">0</span></p>
      <p><strong>Llaves:</strong> <span id="perfilKeys">0</span></p>
    </div>
  </div>

  <!-- Modal de Inventario -->
  <div id="inventoryModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarInventarioBtn">√ó</span>
      <h2>üéí Inventario de Cultivos</h2>
      <div id="plantList"></div>
    </div>
  </div>

  <!-- Modal de Cofres -->
  <div id="cofreModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarCofreBtn">√ó</span>
      <h2 id="tituloCofre">üéÅ Cofre Plata</h2>
      <div class="tab-selector">
        <button id="tabPlata" class="active">Plata</button>
        <button id="tabOro">Oro</button>
        <button id="tabDiamante">Diamante</button>
      </div>
      <img id="imgCofre" class="cofre-img" src="https://i.imgur.com/dYd1aoN.png" alt="Cofre" />
      <div class="cofre-info" id="cofreInfo">
        Necesitas <span id="llavesNecesarias">10</span> llaves para abrir este cofre.<br>
        <span class="cofre-keys">Tienes: <span id="userKeys">0</span> llaves</span>
        <div class="cofre-probabilidad">
          Probabilidades: <b>√âpico 10%</b> | <b>Legendario 2.5%</b>
        </div>
      </div>
      <button id="abrirCofreBtn" class="cofre-open-btn">Abrir Cofre de Plata</button>
      <div id="resultadoCofre"></div>
    </div>
  </div>

  <!-- Modal de Tienda (pr√≥ximamente) -->
  <div id="shopModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarTiendaBtn">√ó</span>
      <h2>üè™ Tienda VIP</h2>
      <p>¬°Pr√≥ximamente!</p>
    </div>
  </div>

  <!-- Modal de Opciones -->
  <div id="optionsModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" id="cerrarOpcionesBtn">√ó</span>
      <h2>‚öôÔ∏è Opciones</h2>
      <div class="opcion">
        <label for="brillo">Brillo:</label>
        <input type="range" id="brillo" min="50" max="100" value="100">
      </div>
      <div class="opcion">
        <label for="musica">M√∫sica:</label>
        <input type="checkbox" id="musica" checked>
      </div>
      <button id="btnBorrarProgreso">üóëÔ∏è Borrar Progreso</button>
    </div>
  </div>
<script>
  // Datos iniciales de cultivos (actualizados con tus im√°genes)
  const PLANTS_DEFAULT = [
    { nombre: "Pi√±a dorada", valor: 500, cantidad: 0, rareza: "Legendaria", img: "https://i.imgur.com/y0et0jw.png" },
    { nombre: "Uva el√©ctrica", valor: 350, cantidad: 0, rareza: "Legendaria", img: "https://i.imgur.com/igHZ4i0.png" },
    { nombre: "Cereza de lava", valor: 350, cantidad: 0, rareza: "Legendaria", img: "https://i.imgur.com/FZ3ix2y.png" },
    { nombre: "Flor de cacao", valor: 180, cantidad: 0, rareza: "√âpica", img: "https://i.imgur.com/teOuyYL.png" },
    { nombre: "Mel√≥n √°mbar", valor: 180, cantidad: 0, rareza: "√âpica", img: "https://i.imgur.com/fnASHdb.png" },
    { nombre: "Frijol lunar", valor: 70, cantidad: 0, rareza: "Rara", img: "https://i.imgur.com/uENLIRn.png" },
    { nombre: "Zanahoria cristal", valor: 70, cantidad: 0, rareza: "Rara", img: "https://i.imgur.com/axk0pOC.png" },
    { nombre: "Ma√≠z dulce", valor: 30, cantidad: 0, rareza: "Com√∫n", img: "https://i.imgur.com/E2qm0LM.png" },
    { nombre: "Tomate solar", valor: 30, cantidad: 0, rareza: "Com√∫n", img: "https://i.imgur.com/imJ5yn3.png" },
    { nombre: "Trigo solar", valor: 30, cantidad: 0, rareza: "Com√∫n", img: "https://i.imgur.com/X8D6y8K.png" }
  ];

  // Variables del juego
  let coins = 0, keys = 0;
  let plants = JSON.parse(JSON.stringify(PLANTS_DEFAULT));
  let cofresGratis = { oro: 0, plata: 0 };
  let lastRecolectado = Date.now();

  // Probabilidades de cofres (ajustadas)
  const probabilidades = {
    plata: [ 
      { rareza: "Legendaria", prob: 2.5 }, 
      { rareza: "√âpica", prob: 10 }, 
      { rareza: "Rara", prob: 37.5 }, 
      { rareza: "Com√∫n", prob: 50 } 
    ],
    oro: [ 
      { rareza: "Legendaria", prob: 5 }, 
      { rareza: "√âpica", prob: 25 }, 
      { rareza: "Rara", prob: 35 }, 
      { rareza: "Com√∫n", prob: 35 } 
    ],
    diamante: [ 
      { rareza: "Legendaria", prob: 10 }, 
      { rareza: "√âpica", prob: 30 }, 
      { rareza: "Rara", prob: 30 }, 
      { rareza: "Com√∫n", prob: 30 } 
    ]
  };

  // Sistema de producci√≥n
  const periodoRecolecta = 12 * 60 * 60 * 1000; // 12 horas

  function produccionPorMinuto() {
    let total = 0;
    plants.forEach(p => total += (p.valor * p.cantidad) / 1440);
    return total;
  }

  function actualizarBarraProduccion() {
    const ahora = Date.now();
    const tiempoPasado = Math.max(0, ahora - lastRecolectado);
    const progreso = Math.min(1, tiempoPasado / periodoRecolecta);
    document.getElementById("barraProduccion").style.width = (progreso * 100) + "%";
    let tiempoRestante = periodoRecolecta - tiempoPasado;
    if (tiempoRestante < 0) tiempoRestante = 0;
    document.getElementById("timerProduccion").innerText = msToHMS(tiempoRestante);
    document.getElementById("btnRecolectar").disabled = progreso < 1 || produccionPorMinuto() === 0;
  }

  function msToHMS(ms) {
    let total = Math.floor(ms / 1000);
    const h = String(Math.floor(total / 3600)).padStart(2, "0");
    total %= 3600;
    const m = String(Math.floor(total / 60)).padStart(2, "0");
    const s = String(total % 60).padStart(2, "0");
    return `${h}:${m}:${s}`;
  }
// ----------- SISTEMA DE COFRES -----------
const cofres = {
  plata: { 
    nombre: "Plata", 
    img: "https://i.imgur.com/dYd1aoN.png", 
    llaves: 10, 
    btnTexto: "Abrir Cofre de Plata" 
  },
  oro: { 
    nombre: "Oro", 
    img: "https://i.imgur.com/HpkO9qJ.png", 
    llaves: 50, 
    btnTexto: "Abrir Cofre de Oro" 
  },
  diamante: { 
    nombre: "Diamante", 
    img: "https://i.imgur.com/HanPFOR.png", 
    llaves: 100, 
    btnTexto: "Abrir Cofre Diamante" 
  }
};

let tipoCofreSeleccionado = "plata";

function actualizarCofreUI(tipo) {
  const cofre = cofres[tipo];
  document.getElementById("tituloCofre").innerText = `üéÅ Cofre ${cofre.nombre}`;
  document.getElementById("imgCofre").src = cofre.img;
  document.getElementById("llavesNecesarias").innerText = cofre.llaves;
  let gratis = cofresGratisDisponibles(tipo);
  let infoExtra = gratis > 0 ? `<div style="color:#24c24c;font-weight:bold;">Te quedan ${gratis} cofres gratis</div>` : "";
  document.getElementById("cofreInfo").innerHTML = `
    Necesitas <span id="llavesNecesarias">${cofre.llaves}</span> llaves.<br>
    <span class="cofre-keys">Tienes: <span id="userKeys">${keys}</span> llaves</span>
    ${infoExtra}
  `;
  document.getElementById("abrirCofreBtn").innerText = cofre.btnTexto;
  document.getElementById("abrirCofreBtn").disabled = (keys < cofre.llaves && gratis === 0);
}

function abrirCofre(tipo, esGratis) {
  const imgCofre = document.getElementById("imgCofre");
  imgCofre.classList.add("abierto");
  setTimeout(() => {
    imgCofre.classList.remove("abierto");
    const resultado = calcularCofre(tipo);
    mostrarResultadoCofre(resultado);
  }, 700);
}

function calcularCofre(tipo) {
  const tabla = probabilidades[tipo];
  const random = Math.random() * 100;
  let acumulado = 0;
  let rarezaElegida = "Com√∫n";
  for (const p of tabla) {
    acumulado += p.prob;
    if (random <= acumulado) {
      rarezaElegida = p.rareza;
      break;
    }
  }
  const posibles = plants.filter(p => p.rareza === rarezaElegida);
  return posibles[Math.floor(Math.random() * posibles.length)];
}

function mostrarResultadoCofre(planta) {
  const resultado = document.getElementById("resultadoCofre");
  resultado.innerHTML = `
    <div style="display:flex; flex-direction:column; align-items:center;">
      <img src="${planta.img}" alt="${planta.nombre}" style="width:90px; margin:12px 0; border-radius:12px;">
      <div style="font-size:1.15em; font-weight:bold; color:#3777ca;">
        ¬°Obtuviste ${planta.nombre} (${planta.rareza})!
      </div>
    </div>
  `;
  const encontrada = plants.find(p => p.nombre === planta.nombre);
  if (encontrada) encontrada.cantidad++;
  guardarProgreso();
  mostrarInventario();
}

// ----------- PERFIL Y RANGOS -----------
function getRango(produccionDia) {
  if (produccionDia >= 1000) return "Minero Excepcional";
  if (produccionDia >= 600) return "Minero Gold";
  if (produccionDia >= 300) return "Minero Experimentado";
  if (produccionDia >= 100) return "Minero Plata";
  return "Minero Principiante";
}

function actualizarPerfil() {
  const prodDia = plants.reduce((total, p) => total + (p.valor * p.cantidad), 0);
  const rango = getRango(prodDia);
  document.getElementById("perfilRango").innerText = rango;
  document.getElementById("perfilRango").setAttribute("data-rango", rango);
  document.getElementById("perfilProduccion").innerText = prodDia;
  document.getElementById("perfilCoins").innerText = coins;
  document.getElementById("perfilKeys").innerText = keys;
}
// ----------- INVENTARIO -----------
function mostrarInventario() {
  const lista = document.getElementById("plantList");
  lista.innerHTML = "";
  let totalProd = 0;

  plants.forEach(planta => {
    if (planta.cantidad > 0) {
      totalProd += planta.valor * planta.cantidad;
      lista.innerHTML += `
      <div class="plant">
        <img src="${planta.img}" alt="${planta.nombre}">
        <div class="plant-info">
          <b>${planta.nombre}</b> 
          <span style="color:${
            planta.rareza === "Legendaria" ? "#ff00ff" : 
            planta.rareza === "√âpica" ? "#9b51e0" : 
            planta.rareza === "Rara" ? "#3777ca" : "#666"
          }">[${planta.rareza}]</span><br>
          Cantidad: <b>${planta.cantidad}</b>
          <span class="production">+${planta.valor * planta.cantidad} monedas/d√≠a</span>
        </div>
      </div>
      `;
    }
  });

  if (totalProd === 0) {
    lista.innerHTML = `<div style="color:#888;font-size:1.1em;margin:20px 0;">A√∫n no tienes cultivos.<br>¬°Abre cofres para empezar!</div>`;
  }
}

// ----------- EVENTOS DE BOTONES -----------
document.getElementById("botonPerfil").addEventListener("click", () => {
  actualizarPerfil();
  document.getElementById("profileModal").style.display = "flex";
});

document.getElementById("botonInventario").addEventListener("click", () => {
  mostrarInventario();
  document.getElementById("inventoryModal").style.display = "flex";
});

document.getElementById("botonCofre").addEventListener("click", () => {
  document.getElementById("cofreModal").style.display = "flex";
  actualizarCofreUI("plata");
});

document.getElementById("botonOpciones").addEventListener("click", () => {
  document.getElementById("optionsModal").style.display = "flex";
});

// Cerrar modales
document.querySelectorAll(".close-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    this.closest(".modal").style.display = "none";
  });
});

// Tabs de cofres
document.getElementById("tabPlata").addEventListener("click", () => {
  tipoCofreSeleccionado = "plata";
  actualizarCofreUI("plata");
});
document.getElementById("tabOro").addEventListener("click", () => {
  tipoCofreSeleccionado = "oro";
  actualizarCofreUI("oro");
});
document.getElementById("tabDiamante").addEventListener("click", () => {
  tipoCofreSeleccionado = "diamante";
  actualizarCofreUI("diamante");
});

// Bot√≥n de abrir cofre
document.getElementById("abrirCofreBtn").addEventListener("click", () => {
  const tipo = tipoCofreSeleccionado;
  const cofre = cofres[tipo];
  const gratis = cofresGratisDisponibles(tipo);

  if (gratis > 0) {
    cofresGratis[tipo]--;
    abrirCofre(tipo, true);
  } else if (keys >= cofre.llaves) {
    keys -= cofre.llaves;
    abrirCofre(tipo, false);
  }

  guardarProgreso();
  actualizarLlaves();
  actualizarCofreUI(tipo);
});
// ----------- PRODUCCI√ìN AUTOM√ÅTICA -----------
document.getElementById("btnRecolectar").addEventListener("click", () => {
  const ahora = Date.now();
  let tiempoPasado = Math.max(0, ahora - lastRecolectado);
  if (tiempoPasado > periodoRecolecta) tiempoPasado = periodoRecolecta;
  
  const minutos = Math.floor(tiempoPasado / 60000);
  let monedasRecoleccion = 0;
  
  plants.forEach(p => {
    monedasRecoleccion += (p.valor * p.cantidad) * (minutos / 1440);
  });

  monedasRecoleccion = Math.floor(monedasRecoleccion);
  coins += monedasRecoleccion;
  lastRecolectado = ahora;
  
  guardarProgreso();
  actualizarMonedas();
  actualizarBarraProduccion();
  animarRecoleccion(monedasRecoleccion);
});

function animarRecoleccion(monedas) {
  const anim = document.getElementById("recoleccionAnimada");
  anim.style.display = "block";
  anim.innerHTML = `
    <img src="https://i.imgur.com/n9OyA2U.png" style="width:40px;">
    <br>+${monedas} monedas
  `;
  setTimeout(() => { anim.style.display = "none"; }, 1500);
}
  // ----------- GUARDADO Y CARGA -----------
  function guardarProgreso() {
    localStorage.setItem("xanfarm-progreso", JSON.stringify({
      coins, keys, plants, cofresGratis, lastRecolectado
    }));
  }

  function cargarProgreso() {
    const data = localStorage.getItem("xanfarm-progreso");
    if (!data) return false;
    
    try {
      const obj = JSON.parse(data);
      coins = obj.coins || 0;
      keys = obj.keys || 0;
      plants = obj.plants || JSON.parse(JSON.stringify(PLANTS_DEFAULT));
      cofresGratis = obj.cofresGratis || { oro: 0, plata: 0 };
      lastRecolectado = obj.lastRecolectado || Date.now();
      return true;
    } catch {
      return false;
    }
  }

  // ----------- FUNCIONES AUXILIARES -----------
  function actualizarMonedas() {
    document.getElementById("coins").innerText = coins;
    if (document.getElementById("perfilCoins")) {
      document.getElementById("perfilCoins").innerText = coins;
    }
  }

  function actualizarLlaves() {
    document.getElementById("keys").innerText = keys;
    if (document.getElementById("userKeys")) {
      document.getElementById("userKeys").innerText = keys;
    }
    if (document.getElementById("perfilKeys")) {
      document.getElementById("perfilKeys").innerText = keys;
    }
  }

  // ----------- INICIALIZACI√ìN -----------
  if (!cargarProgreso()) {
    // Datos iniciales para nuevos jugadores
    coins = 100;
    keys = 5;
    cofresGratis = { oro: 1, plata: 3 };
    guardarProgreso();
  }

  // Actualizar UI al cargar
  actualizarMonedas();
  actualizarLlaves();
  actualizarBarraProduccion();
  setInterval(actualizarBarraProduccion, 1000);
  mostrarInventario();
</script>